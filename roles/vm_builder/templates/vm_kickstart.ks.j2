install
lang en_US.UTF-8
keyboard us
timezone Etc/UTC
text
# Installation source points to the local repository VM
url --url="{{ vm_location_url }}" 
repo --name="AppStream" --baseurl="http://{{ hostvars['rhcsa_repo']['ansible_host'] }}/centos9stream/AppStream"

# Static IP configuration for the exam VM
network --bootproto=static --ip={{ vm_ip }} --netmask=255.255.255.0 --gateway=192.168.1.1 --device=eth0 --nameserver={{ hostvars['rhcsa_repo']['ansible_host'] }} --hostname={{ vm_name }}

# VM1 Root Password: pa$$word (will be changed for VM2 later)
# Hash for 'pa$$word': $6$rhcsa_salt$86yN3D4i9B9e0.bS2x/7c1tM1w8Y5s7V3f6P5F6I2
rootpw --iscrypted $6$rhcsa_salt$86yN3D4i9B9e0.bS2x/7c1tM1w8Y5s7V3f6P5F6I2
auth --enableshadow --passalgo=sha512
selinux --enforcing
firewall --enabled --ssh

# Standard exam user: sys_admin
user --name=sys_admin --iscrypted $6$rhcsa_salt$86yN3D4i9B9e0.bS2x/7c1tM1w8Y5s7V3f6P5F6I2 --groups=wheel

bootloader --location=mbr

# Partitioning: Use vda for OS, leaving vdb and vdc completely free for LVM/Swap objectives on VM1
clearpart --all --initlabel
part / --fstype="xfs" --size=7168 
part /boot --fstype="xfs" --size=1024
# Swap will be configured later by the exam taker

%packages
@^minimal-environment
@guest-agents
vim
net-tools
nfs-utils
vfat-utils
parted
lsscsi
tar
gzip
bzip2
cronie
at
firewalld
httpd # Install httpd on both, VM2 will configure it.
%end

%post
# --- Network Persistence Fix (CRITICAL) ---
# Create a static configuration file for NetworkManager in %post
cat << EOF > /etc/sysconfig/network-scripts/ifcfg-eth0
TYPE=Ethernet
BOOTPROTO=none
NAME=eth0
DEVICE=eth0
ONBOOT=yes
IPADDR={{ vm_ip }}
NETMASK=255.255.255.0
GATEWAY=192.168.1.1
DNS1={{ hostvars['rhcsa_repo']['ansible_host'] }}
EOF

# Ensure sys_admin has wheel/sudo access
echo "sys_admin ALL=(ALL) NOPASSWD: ALL" >> /etc/sudoers.d/sys_admin
chmod 0440 /etc/sudoers.d/sys_admin
%end