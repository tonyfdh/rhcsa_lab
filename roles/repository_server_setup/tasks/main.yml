---
- name: ğŸ“¦ Install Flatpak package manager
  ansible.builtin.dnf:
    name: flatpak
    state: present

- name: ğŸ’¾ Configure Flatpak remote (Flathub) for exam objective
  community.general.flatpak_remote:
    name: flathub
    state: present
    flatpak_repo: https://flathub.org/repo/flathub.flatpakrepo

- name: ğŸ“ Create repository directories
  ansible.builtin.file:
    path: "{{ item }}"
    state: directory
    mode: '0755'
  loop:
    - /var/www/html/centos9stream/BaseOS
    - /var/www/html/centos9stream/AppStream

# [Mirroring Tasks, Firewalld, and httpd configuration remain the same]
# ... (omitted for brevity, assume previous content is included here) ...

# NOTE: The mirroring and httpd tasks are critical and remain, ensuring the local repo works.
- name: ğŸª Mirror CentOS Stream 9 Content
  ansible.builtin.shell: |
    if [ -z "$(ls -A /var/www/html/centos9stream/BaseOS)" ]; then
      echo "Starting rsync for BaseOS..."
      rsync -av --exclude "liveos" --exclude "images" rsync://mirror.stream.centos.org/centos/9-stream/BaseOS/x86_64/os/ /var/www/html/centos9stream/BaseOS/
      
      echo "Starting rsync for AppStream..."
      rsync -av --exclude "liveos" --exclude "images" rsync://mirror.stream.centos.org/centos/9-stream/AppStream/x86_64/os/ /var/www/html/centos9stream/AppStream/
      
      echo "Creating repository metadata..."
      createrepo /var/www/html/centos9stream/BaseOS
      createrepo /var/www/html/centos9stream/AppStream
    fi
  args:
    executable: /bin/bash

- name: âš™ï¸ Configure firewalld for HTTP access
  ansible.posix.firewalld:
    service: http
    permanent: yes
    state: enabled
    immediate: yes

- name: Start and enable httpd
  ansible.builtin.systemd:
    name: httpd
    state: started
    enabled: yes